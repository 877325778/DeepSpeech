#!/bin/sh

set -x

source ../tmp/venv/bin/activate

rm -f ../keep/*.hdf5
rm -f ../keep/*.csv

echo 'model_checkpoint_path: "best_validation"
all_model_checkpoint_paths: "best_validation"' > ../keep/checkpoint

python3 -u DeepSpeech.py \
  --train_files "/snakepit/shared/data/OpenSLR/LibriSpeech/librivox-test-clean.csv" \
  --dev_files "/snakepit/shared/data/OpenSLR/LibriSpeech/librivox-test-clean.csv" \
  --test_files "/snakepit/shared/data/OpenSLR/LibriSpeech/librivox-test-clean.csv" \
  --train_batch_size 24 \
  --dev_batch_size 48 \
  --test_batch_size 48 \
  --noearly_stop \
  --epoch -1 \
  --notrain \
  --test \
  --validation_step 1 \
  --dropout_rate 0.2 \
  --learning_rate 0.0001 \
  --checkpoint_dir "../keep" \
  --summary_dir "../keep/summaries" \
  --decoder_library_path "../tmp/libctc_decoder_with_kenlm.so" \
  --train_cached_features_path "/snakepit/shared/data/OpenSLR/LibriSpeech/librivox-test-clean.hdf5" \
  --dev_cached_features_path "/snakepit/shared/data/OpenSLR/LibriSpeech/librivox-test-clean.hdf5" \
  --test_cached_features_path "/snakepit/shared/data/OpenSLR/LibriSpeech/librivox-test-clean.hdf5"

# python3 -u DeepSpeech.py \
#   --train_files "/snakepit/shared/data/mozilla/DeepSpeech/fisher_librivox_swb-train_lt550000.csv,/snakepit/shared/data/mozilla/CommonVoice/v2.0-alpha1.0/en/cv_en_valid_train.csv" \
#   --dev_files "/snakepit/shared/data/OpenSLR/LibriSpeech/librivox-dev-clean.csv,/snakepit/shared/data/OpenSLR/LibriSpeech/librivox-dev-other.csv,/snakepit/shared/data/mozilla/CommonVoice/v2.0-alpha1.0/en/cv_en_valid_dev.csv" \
#   --test_files "/snakepit/shared/data/OpenSLR/LibriSpeech/librivox-test-clean.csv" \
#   --train_batch_size 24 \
#   --dev_batch_size 48 \
#   --test_batch_size 48 \
#   --noearly_stop \
#   --epoch 30 \
#   --validation_step 1 \
#   --dropout_rate 0.2 \
#   --learning_rate 0.0001 \
#   --checkpoint_dir "../keep" \
#   --summary_dir "../keep/summaries" \
#   --decoder_library_path "../tmp/libctc_decoder_with_kenlm.so" \
#   --train_cached_features_path "/snakepit/shared/data/mozilla/DeepSpeech/librivox-fisher-swb-cv2.0-train.hdf5" \
#   --test_cached_features_path "/snakepit/shared/data/OpenSLR/LibriSpeech/librivox-test-clean.hdf5"